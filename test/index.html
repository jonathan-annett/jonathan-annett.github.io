


<html>
    
    <head>
        
    </head>
    
    
    <body>
        
        <script>
        
        
            function loadScript(src,cb) {
                
                const _a         = Array.prototype, cpArgs = _a.slice.call.bind (_a.slice);
                
                var ifrm = document.createElement('iframe');
                ifrm.setAttribute('id', 'ifrm'); // assign an id
                document.body.appendChild(ifrm); // to place at end of document
                
                
                
                let script = document.createElement("script");
                script.src = src;
                
                
                
                
                const hooked = []; 
                let   timeout;
                function hook(fn,args){
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    
                    if (fn==='define' || fn==='require') {
                        hooked.push([fn,src,ifrm,script,args]);
                    
                       ifrm.onload = null;
                       ifrm.removeEventListener('DOMContentLoaded', (event) => {
                          hook("DOMContentLoaded",cpArgs(arguments)); 
                       });
                       
                       cb (hooked);
                       timeout = undefined;
                    } else {
                        timeout = setTimeout(scriptLoadTimeout,100);
                    }
                }
                        
                ifrm.require = function () {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout=undefined;
                    }
                    hook("require",cpArgs(arguments));
                };        
                        
                ifrm.define = function () {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout=undefined;
                    }
                    hook("define",cpArgs(arguments));
                };
                ifrm.define.amd={};
                
                ifrm.onload = function (e) {
                    ifrm.onload=undefined;
                    hook("onload");
                };
                
                function onDOMContentLoaded () {
                    ifrm.removeEventListener('DOMContentLoaded',onDOMContentLoaded);
                    
                     
                    var iFrameHead = ifrm.document.getElementsByTagName("head")[0];
                    
                    iFrameHead.appendChild(script);
                    hook("DOMContentLoaded"); 
                }
                
                function scriptLoadTimeout() {
                    timeout = undefined;
                    hook("timeout");
                } 
                
                ifrm.addEventListener('DOMContentLoaded',onDOMContentLoaded);
                
            
               
                
                timeout = setTimeout(scriptLoadTimeout,1000);
               
                
    
            } 
            
            

            loadScript("test.js",function(args) {
                
                
                
            });
            
            
            
            
        </script>
        
    </body>
</html>