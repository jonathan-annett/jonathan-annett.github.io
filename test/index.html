


<html>
    
    <head>
        
    </head>
    
    
    <body>
        
        <script>
        
        
            function loadScript(src,def,req,meta) {
                
                const _a         = Array.prototype, cpArgs = _a.slice.call.bind (_a.slice);
                
                
                if (loadScript.iframe) {
                    proceed();
                } else {
                    createIframe() 
                }
                
                function createIframe() {
                    let iframe = document.createElement('iframe');
                    iframe.style.display="none";
                    
                    iframe.onload = proceed; 
                    iframe.src = 'about:blank';
                    loadScript.iframe=iframe;
                    document.body.appendChild(iframe);
                }
                
                function iframe_ready() {
                    iframe.require = function () {
                        if (loadScript.cleanup_timer) clearTimeout(loadScript.cleanup_timer);
                        loadScript.cleanup_timer  = setTimeout(cleanup,15000);
                        script.meta.href=script.src;
                        script.meta.baseURI=script.baseURI;
                        return req.apply(undefined,[script.meta].concat(cpArgs(arguments)));
                    };        
                            
                    iframe.define = function () {
                        if (loadScript.cleanup_timer) clearTimeout(loadScript.cleanup_timer);
                        loadScript.cleanup_timer  = setTimeout(cleanup,15000);
                        script.meta.href=script.src;
                        script.meta.baseURI=script.baseURI;
                        return def.apply(undefined,[script.meta].concat(cpArgs(arguments)));
                    };
                    iframe.define.amd={};
                    
                    
                    iframe.contentWindow.define  = iframe.define;
                    iframe.contentWindow.require = iframe.require;

               }
                
               function proceed() {     
                   let iframe = loadScript.iframe;
                   var script;
                   script = document.createElement("script");
                   script.meta=meta||{};
                   script.meta.src=src;
                   script.src=src;
                   iframe.contentWindow.document.body.appendChild(script);
                };
                
                function cleanup () {
                    loadScript.cleanup_timer = undefined;
                    if (script) {
                        iframe.contentWindow.document.body.removeChild(script);
                    }
                    if (iframe) {
                        document.body.removeChild(iframe);
                    }
                }
                
                
            } 
            
            const _a         = Array.prototype, cpArgs = _a.slice.call.bind (_a.slice);
                
            
            loadScript("test.js",function(){
                console.log("define",cpArgs(arguments));
            },function(){
                console.log("require",cpArgs(arguments));
            });

        </script>
        
    </body>
</html>