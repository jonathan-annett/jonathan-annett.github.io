


<html>
    
    <head>
        
    </head>
    
    
    <body>
        
        <script>
        
        
            function loadScript(src,def,req) {
                
                const _a         = Array.prototype, cpArgs = _a.slice.call.bind (_a.slice);
                
                let iframe = document.createElement('iframe');
                let cleanup_timer,script;
                iframe.onload = function() {
                    iframe.require = function () {
                        if (cleanup_timer) clearTimeout(cleanup_timer);
                        cleanup_timer  = setTimeout(cleanup,15000);
                        return req.apply(undefined,cpArgs(arguments));
                    };        
                            
                    iframe.define = function () {
                        if (cleanup_timer) clearTimeout(cleanup_timer);
                        cleanup_timer  = setTimeout(cleanup,15000);
                        return def.apply(undefined,cpArgs(arguments));
                    };
                    iframe.define.amd={};
                    
                    
                    iframe.contentWindow.define  = iframe.define;
                    iframe.contentWindow.require = iframe.require;
                    
                    
                    const script = document.createElement("script");
                    script.src=src;
                    iframe.contentWindow.document.body.appendChild(script);
                    
                };
                iframe.src = 'about:blank';
                document.body.appendChild(iframe);
                
                
                function cleanup () {
                    cleanup_timer = undefined;
                    iframe.contentWindow.document.body.removChild(script);
                    document.body.removeChild(iframe);
                }

            } 
            
            loadScript("test.js",function(){
                console.log("define",cpArgs(arguments));
            },function(){
                console.log("require",cpArgs(arguments));
            });

        </script>
        
    </body>
</html>