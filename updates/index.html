<html>
    <head>

    </head>
    <body>
        <script>

            const permitted = [
                "465669497071087825c8c0d368dd92da7b375d39223913d447a091b28cf2973d", // dev
                "6b4c94c326845e6d99949a614097af5d9258ec8957cc725f27c08b9d9c3ddd4d"  // test vm
            ];

            let key = localStorage.getItem('local.key');

            if (!key) {
                key = (Math.random().toString(36)+Date.now().toString(36)+Math.random().toString(36)).replace(/\0\./g,'');
                localStorage.setItem('local.key',key);
            }


            const encoder = new TextEncoder();
            const data = encoder.encode(key);

            crypto.subtle.digest("SHA-256", data).then(function(digest){
                const hashArray = Array.from(new Uint8Array(digest)); // convert buffer to byte array
                const hashHex = hashArray
                    .map((b) => b.toString(16).padStart(2, "0"))
                    .join(""); // convert bytes to hex string
                return Promise.resolve(hashHex); 
            }).then(function(hex){

                if (permitted.indexOf(hex)>=0) {
                    
                    fetch("index.json").then(function(response){
                        return response.json();
                    }).then(function(data){ 

                        document.body.innerHTML = `
                        <h1>download links</h1>
                        ${

                        data.packages.map(function(pkg){
                            return `<a href="${pkg[ "update.info"] .updates}/update.html">${
                                pkg.name

                            }</a><br>`
                        })
                        
                        }`;

                    });
                } else {
                    document.body.innerHTML = 'No files found.';
                    console.log(hex);
                }
            });
            

        </script>
    </body>
</html>