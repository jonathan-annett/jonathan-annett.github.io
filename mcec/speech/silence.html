<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silence Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }

        .indicator {
            font-size: 2em;
            padding: 20px;
            border: 2px solid #ccc;
            border-radius: 10px;
            display: none;
            background-color: #ffcccc;
            color: #a00;
        }

        .indicator.show {
            display: block;
        }
    </style>
</head>

<body>
    <button id="startBtn">start</button>
    
    <div id="silence-indicator" class="indicator">
        <p>SILENCE</p>
        <p class="info"></p>

       
    </div>
    <script>
        class SilenceDetector {
            constructor(threshold = 0.01, silenceDuration = 5000) {
                this.threshold = threshold;
                this.silenceDuration = silenceDuration;
                this.silenceTimeout = null;
                this.isSilent = false;
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.init();
            }

            async init() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.audioInput = this.audioContext.createMediaStreamSource(stream);
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 256;
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    this.audioInput.connect(this.analyser);
                    this.monitor();
                } catch (error) {
                    console.error('Error accessing audio input:', error);
                }
            }

            monitor() {
                this.analyser.getByteFrequencyData(this.dataArray);
                let sum = 0;
                for (let i = 0; i < this.dataArray.length; i++) {
                    sum += this.dataArray[i];
                }
                const average = sum / this.dataArray.length;

                if (average < this.threshold * 256) {
                    if (!this.isSilent) {
                        if (this.silenceTimeout === null) {
                            this.silenceTimeout = setTimeout(() => {
                                this.isSilent = true;
                                this.emitEvent('silenceDetected', Date.now());
                            }, this.silenceDuration);
                        }
                    }
                } else {
                    if (this.isSilent) {
                        this.isSilent = false;
                        this.emitEvent('audioResumed', Date.now());
                    }
                    if (this.silenceTimeout !== null) {
                        clearTimeout(this.silenceTimeout);
                        this.silenceTimeout = null;
                    }
                }

                requestAnimationFrame(() => this.monitor());
            }

            emitEvent(eventType, timestamp) {
                const event = new CustomEvent(eventType, { detail: { timestamp } });
                window.dispatchEvent(event);
            }
        }

        // Usage example
        const startButton = document.querySelector('#startBtn');

        startButton.addEventListener('click', function () {
            startButton.disabled = true;

            const silenceDetector = new SilenceDetector(0.01, 5000);

            const silenceIndicator = document.getElementById('silence-indicator');
            const silenceInfo = document.querySelector('#silence-indicator p.info');

            let updateTimeout;



            window.addEventListener('silenceDetected', (event) => {
                console.log('Silence detected at:', event.detail.timestamp);
                silenceIndicator.classList.add('show');
                if (updateTimeout) clearTimeout(updateTimeout);

                updateTimeout = setTimeout(function dispSeconds() {
                    const elapsedMsec = Date.now() - event.detail.timestamp;
                    const Seconds = (elapsedMsec / 1000).toFixed(1);
                    silenceInfo.textContent = `${elapsed} seconds`;
                    updateTimeout = setTimeout(dispSeconds, 100);
                }, 100);
            });

            window.addEventListener('audioResumed', (event) => {
                console.log('Audio resumed at:', event.detail.timestamp);
                silenceIndicator.classList.remove('show');
                if (updateTimeout) {
                    clearTimeout(updateTimeout);
                    updateTimeout = undefined;
                }
            });

        });
    </script>
</body>

</html>